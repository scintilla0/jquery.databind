/*!
 * jquery.databind.js - version 1.6.1 - 2023-05-18
 * Copyright (c) 2023 scintilla0 (https://github.com/scintilla0)
 * @license MIT License http://www.opensource.org/licenses/mit-license.html
 * @license GPL2 License http://www.gnu.org/licenses/gpl.html
 */
(function(){const CORE={a:"_data_bind_no_",b:"activeItem",c:"data-bind",d:"data-bind-option-text",e:"data-check-field",h:"data-display",f:"data-display-hide-callback",g:"display-only",i:"_callback_function_name"},OUTSIDE_CONSTANTS={HIGHLIGHT_MINUS:"data-enable-highlight-minus"},DEFAULT_CSS={NON_SELECTABLE_OPACITY:"0.5"},CommonUtil=_CommonUtil();let dataBindContainer={},dataBindFields=[],displayControlInitiator={},displayControlImpacted={},nonIdIndex=0,activeItem,displayControlFirstChange=!0;$("["+CORE.c+"]").each(prepareGroup),$(document).on("keyup change","input:text["+CORE.c+"]",bindAction).on("change","select["+CORE.c+"]",bindAction).on("click","input["+CORE.e+"], button["+CORE.e+"]",checkAction),$("input:checkbox["+CORE.e+"]").each(prepareCheckReverseLinkage),CommonUtil.initAndDeployListener("input."+CORE.g+", select."+CORE.g+", textarea."+CORE.g,prepareDisplayOnlyContent),CommonUtil.initAndDeployListener("["+CORE.h+"]",prepareDisplayControlEvent);for(let t in displayControlInitiator){let e=nameSelector(t);$(e).filter(":not(:checkbox):not(:radio), :checkbox:checked, :radio:checked").change(),setTimeout((()=>displayControlFirstChange=!1))}function bindAction({target:t}){activeItem=t.id;let e=$(t).attr(CORE.c);CommonUtil.exists(dataBindContainer[e])||$("["+CORE.c+"='"+e+"']").each(prepareGroup),dataBindContainer[e]=t.value}function prepareGroup(t,e){let i=$(e).attr(""+CORE.c);CommonUtil.isBlank(i)||(CommonUtil.isBlank(e.id)&&(e.id=CORE.a+nonIdIndex++),dataBindFields.includes(i)||(dataBindFields.push(i),prepareDataEvent(i)))}function prepareDataEvent(t){Object.defineProperty(dataBindContainer,t,{set:function(e){let i=$("["+CORE.c+"='"+t+"']"),n=$("[id='"+CommonUtil.wrapQuotes(activeItem)+"']"),a=$(n).css("color");$(i).each(((t,o)=>{let l=activeItem!==$(o).attr("id");if(l){if($(o).hasClass("select2Used")){let t=$(o).find("option[value='"+e+"']");0===$(t).length&&(e="",t=$(o).find("option[value='"+e+"']"));let i=$(t).text();$(o).next().find("span.select2-selection__rendered").html(i).attr("title",i)}if(CommonUtil.exists($(o).attr(CORE.d)))for(let t=0;t<i.length;t++)if(l){let n=$(i).eq(t);if($(n).is("select")){e=$(n).find("option[value='"+e+"']").html();break}}CommonUtil.setValue(e,!1,$(o)),$(o).blur(),CommonUtil.exists($(n).attr(OUTSIDE_CONSTANTS.HIGHLIGHT_MINUS))&&CommonUtil.exists(a)&&$(o).css("color",a)}}))}})}function checkAction({target:t}){let e=$(t).attr(CORE.e);if(!CommonUtil.isBlank(e)){let i=extractName(e);$("input:checkbox[name"+i[0]+"='"+i[1]+"']").prop("checked",t.checked)}}function prepareCheckReverseLinkage(t,e){let i=$(e).attr(CORE.e);if(!CommonUtil.isBlank(i)){let t=extractName(i),n=$("input:checkbox[name"+t[0]+"='"+t[1]+"']"),a=()=>{$(n).on("click",(function(){$(n).filter(":checked").length===$(n).length?$(e).prop("checked",!0):$(e).prop("checked",!1)}))};a(),CommonUtil.deployNodeAppendListener(n,a)}}function extractName(t){let e=["",null];return t.startsWith("*")||t.startsWith("^")||t.startsWith("$")?(e[0]=t.substring(0,1),t=t.substring(1)):t.endsWith("$")&&(e[0]=t.substring(t.length-1),t=t.substring(0,t.length-1)),e[1]=CommonUtil.wrapQuotes(t),e}function prepareDisplayControlEvent(_,item){let dataBindField=$(item).attr(CORE.h);if(!CommonUtil.exists(dataBindField))return;let itemId=$(item).attr("id");CommonUtil.isBlank(itemId)&&($(item).attr("id",CORE.a+nonIdIndex++),itemId=$(item).attr("id"));let initiatorArray=displayControlImpacted[itemId];CommonUtil.exists(initiatorArray)||(displayControlImpacted[itemId]={},initiatorArray=displayControlImpacted[itemId]);let callbackFunctionName=$(item).attr(CORE.f);CommonUtil.exists(callbackFunctionName)&&(initiatorArray[CORE.i]=callbackFunctionName);for(let field of dataBindField.split(";")){field=field.split(":");let impactArray=displayControlInitiator[field[0]];CommonUtil.exists(impactArray)||(displayControlInitiator[field[0]]=[],impactArray=displayControlInitiator[field[0]]),impactArray.push(itemId),initiatorArray[field[0]]=field[1];let bindDisplayControlEvent=(_,eventItem)=>{$(eventItem).on("change",(function(){for(let impacted of displayControlInitiator[field[0]]){let initiators=displayControlImpacted[impacted],show=!0;for(let t in initiators){let e=$(nameSelector(t)),i=initiators[t];if($(e).is("input:checkbox, input:radio")?show=1===$(e).filter("[value='"+i+"']:checked").length:$(e).is("select")?show=1===$(e).find("option[value='"+i+"']:selected").length:$(e).is("input:text, input:hidden, textarea")?show=$(e).val()===i:$(e).is("label, span")&&(show=$(e).text()===i),!1===show)break}let targetSelector=$("[id='"+impacted+"']");!0===show?$(targetSelector).show():($(targetSelector).hide(),!1===displayControlFirstChange&&CommonUtil.exists(initiators[CORE.i])&&eval(initiators[CORE.i]+"(\"[id='"+impacted+"']\")"))}}))};CommonUtil.initAndDeployListener($(nameSelector(field[0])),bindDisplayControlEvent)}}function nameSelector(t){return"[name='"+t+"']"}function prepareDisplayOnlyContent(t,e){if($(e).is("input:checkbox, input:radio"))$(e).on("click",(()=>!1)),$(e).parent("label, span, div").css("cursor","default").css("opacity",DEFAULT_CSS.NON_SELECTABLE_OPACITY);else{let t=$(e).val(),i=$(e).attr(CORE.c),n=CommonUtil.exists(i)?" "+CORE.c+'="'+i+'"':"";$(e).is("select")&&(t=$(e).find("option[value='"+t+"']").html()),$(e).after("<span"+n+">"+t+"</span>"),$(e).css("display","none")}}function _CommonUtil(){function t(t){return void 0!==t&&null!=t}function e(e){return!(t(e)&&""!==e.trim())}let i={};function n(t,e,n=0){null==i[e]?(i[e]=setTimeout((()=>i[e]=null),n),setTimeout((()=>t.apply()))):(clearTimeout(i[e]),i[e]=setTimeout((()=>i[e]=null),n))}function a(t,e){new MutationObserver((i=>{for(let n of i)for(let i of n.addedNodes){let n=$(i).is(t)?$(i):$(i).find(t);$(n).each(e)}})).observe(document.body,{childList:!0,subtree:!0})}return{exists:t,isBlank:e,wrapQuotes:function(t){return e(t)?t:t.replaceAll("'","\\'").replaceAll('"','\\"')},deployNodeAppendListener:a,initAndDeployListener:function(t,e){$(t).each(e),a(t,e)},setValue:function(t,e,...i){for(let a of i)$(a).each(((i,a)=>{$(a).is("input:radio, input:checkbox")?($(a).prop("checked",!1),$(a).filter("[value='"+t.toString()+"']").prop("checked",!0)):$(a).is("input:text, input:hidden, textarea, select")?$(a).val(t):$(a).is("label, span")?$(a).text(t):$(a).is("a")&&$(a).attr("href",t),!0===e&&n((()=>$(a).blur().change()),$(a).attr("id"))}))}}}})();